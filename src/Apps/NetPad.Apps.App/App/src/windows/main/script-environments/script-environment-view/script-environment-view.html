<import from="./output-view/output-view"></import>

<div class="header ps-2 pe-2 mb-3 d-flex align-items-center">
    <div class="d-flex">
        <button class="btn btn-sm btn-success me-2 ${environment.status === 'Running' ? 'disabled' : ''}"
                show.bind="environment.status !== 'Running'"
                title="${shortcutManager.getShortcutByName('Run').toString()}"
                click.trigger="run()">
            <i class="run-icon"></i>
        </button>
        <button class="btn btn-sm btn-danger me-2"
                show.bind="environment.status === 'Running'"
                title="Stop"
                click.trigger="stop()">
            <i class="stop-icon"></i>
        </button>
        <button class="btn btn-sm btn-secondary me-2"
                title="${shortcutManager.getShortcutByName('Save').toString()}"
                click.trigger="scriptService.save(script.id)">
            <i class="save-icon"></i>
        </button>
        <button class="btn btn-sm btn-secondary"
                title="${shortcutManager.getShortcutByName('Script Properties').toString()}"
                click.trigger="scriptService.openConfigWindow(script.id)">
            <i class="script-properties-icon"></i>
        </button>
    </div>
    <div class="ms-5 d-flex">
        <b>Kind:</b>
        <select class="form-select form-select-sm script-kind-selector ms-3"
                value.bind="kind">
            <!--FEATURE NOT READY YET-->
            <!--<option value="Expression">C# Expression (Not supported yet)</option>-->
            <option value="Program">C# Program</option>
        </select>
    </div>
    <div class="ms-5 me-3 d-flex flex-grow-1">
        <b>Connection:</b>
        <select class="form-select form-select-sm data-connection-selector ms-3"
                value.bind="dataConnection">
            <option model.bind="null">None</option>
            <option repeat.for="connection of dataConnectionStore.connections"
                    model.bind="connection">
                ${connection.name} (${connection.type})
            </option>
        </select>
    </div>
    <div class="ms-auto me-3 text-truncate">
        ${script.config.references.length} References
    </div>
</div>

<div class="flex-grow-height-restricted">
    <div ref="textEditorContainer" class="text-editor-container d-flex">
        <!--
            We only want to attach the editor to the DOM if the script is currently active
            or was activated at some point.
         -->
        <editor if.bind="isActive || activatedAtLeastOnce"
                environment.bind="environment"
                text.two-way="editorText"
                view-model.ref="editor"></editor>
    </div>
    <div ref="outputContainer" class="output-container overflow-hidden">
        <output-view environment.bind="environment"
                     close.bind="collapseResultsView"></output-view>
    </div>
</div>
